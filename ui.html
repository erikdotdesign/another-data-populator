<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <style>
      body {
        font-family: sans-serif;
        margin: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      select, textarea, button {
        font-size: 14px;
        padding: 8px;
        width: 100%;
      }
      textarea {
        height: 200px;
        resize: vertical;
      }
    </style>
  </head>
  <body>
    <h2>Dummy Data Populator</h2>
    <label for="endpoint">Select Preset Endpoint</label>
    <select id="endpoint">
      <option value="">-- Choose a preset --</option>
      <option value="products">Products</option>
      <option value="carts">Carts</option>
      <option value="recipes">Recipes</option>
      <option value="users">Users</option>
      <option value="posts">Posts</option>
      <option value="comments">Comments</option>
      <option value="todos">Todos</option>
      <option value="quotes">Quotes</option>
    </select>

    <label for="json">Paste or Edit JSON Data</label>
    <textarea id="json"></textarea>

    <button id="populate">Populate to Selection</button>

    <script>
      const endpointSelect = document.getElementById('endpoint');
      const jsonTextarea = document.getElementById('json');
      const populateButton = document.getElementById('populate');

      endpointSelect.addEventListener('change', async () => {
        const endpoint = endpointSelect.value;
        if (!endpoint) return;

        const url = `https://dummyjson.com/${endpoint}`;

        try {
          const res = await fetch(url);
          const json = await res.json();
          const data = json[endpoint] || json;
          jsonTextarea.value = JSON.stringify(data, null, 2);
        } catch (e) {
          alert('Failed to fetch data');
        }
      });

      populateButton.addEventListener('click', () => {
        try {
          const data = JSON.parse(jsonTextarea.value);
          parent.postMessage({ pluginMessage: { type: 'populate', data } }, '*');
        } catch (e) {
          alert('Invalid JSON');
        }
      });
    </script>
  </body>
</html>